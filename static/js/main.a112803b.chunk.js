(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{15:function(e,t,i){e.exports={root:"style_root__D1GZz",game:"style_game__1is8e"}},17:function(e,t,i){e.exports={root:"style_root__28lIV"}},28:function(e,t,i){},29:function(e,t,i){"use strict";i.r(t);var a=i(5),s=i(16),r=i.n(s),o=i(17),n=i.n(o),l=i(7),c=i(9),d=i.n(c),h=500,u=800,v=250,p=2,y=300,g=100,f=500,m=400,b=500,x=.2,w=function(e){return e/2},k=800,O={width:150,height:170,y:10},j={buttons:{width:100,height:100,margin:{top:10,right:15}},colors:{names:"red",text:"white"},triggerDebug:!0},B={animation:{ease:"Quad.easeInOut",duration:1e3}},D=i(0),P=i(12),T=i(11),A=i(3),I=i(2),N=i(1),S={tal:{NAME:"TAL",PORTRAIT:"tal"}};function C(e){var t=this;Object.keys(e).forEach((function(i){var a=i,s=e[a];null===s||void 0===s||s.forEach((function(e){var i;(i=t.load)[a].apply(i,Object(A.a)(e))}))}))}var E=S.tal,M=[[{portrait:E.PORTRAIT,name:E.NAME,replica:"Dialog #1"},{portrait:E.PORTRAIT,name:E.NAME,replica:"Dialog #2"},{portrait:E.PORTRAIT,name:E.NAME,replica:"Dialog #3 (long): ----------- ############# ---------------------------- +++++++++++++++++++++++++++++++++++ $$$$$$$$$$$$$$$$$$$$ #################### ######################## ##########################"},{portrait:E.PORTRAIT,name:E.NAME,replica:"Dialog #4"}]],L="assets/",_=S.tal,H=["platforms32x32"],R={image:[].concat(Object(A.a)(H.map((function(e){return[e,"".concat(L,"/levelTiles/").concat(e,".png")]}))),[["playerBody","assets/player/body.png"],["playerVisual","assets/player/ball.png"],["playerWhite","assets/player/ball_white.png"],["spark","assets/env/spark.png"],["diplace","assets/noise.png"],["dialogCenter","assets/ui/dialog-2.png"],["dialogLeft","assets/ui/dialog-1.png"],["dialogRight","assets/ui/dialog-3.png"],["dialogNextButton","assets/ui/dialog-button-next.png"],["dialogSkipButton","assets/ui/dialog-button-skip.png"],[_.PORTRAIT,"assets/portraits/TAL/portrait.png"]]),spritesheet:[["coin","assets/env/coin.png",{frameWidth:32,frameHeight:32,endFrame:9}]],atlas:[["buttons","assets/buttons.png","assets/buttons.json"],["bridges","assets/bridget.png","assets/bridget.json"],["button","assets/env/button.png","assets/env/button.json"]],tilemapTiledJSON:[]},V=i(14),F=i.n(V),W=i(18),$=i(19),J="coinsAmount",Y="currentHp",G="keysList",z="CHANGE_COIN_AMT",X="CHANGE_CURRENT_HP",K="CHANGE_KEYS";function Q(e){return function(t){if(!t)return!1;var i=t[e];return!!i||0===i}}var U=function(e,t,i){return e.addListener(t,i),function(){e.removeListener(t,i)}},Z=function(){function e(){var t=this;Object(D.a)(this,e),this.state={coins:0,hp:100,keys:[]},this.emitter=new $.EventEmitter,this.coinsListener=function(e){return U(t.emitter,z,e)},this.setCoins=function(e){t.state.coins=e,localStorage.setItem(J,JSON.stringify(t.state.coins)),t.emitter.emit(z,t.state.coins)},this.hpListener=function(e){return U(t.emitter,X,e)},this.setHP=function(e){t.state.hp=e,localStorage.setItem(Y,JSON.stringify(t.state.hp)),t.emitter.emit(X,t.state.hp)},this.keysListener=function(e){return U(t.emitter,K,e)},this.setKey=function(e){Array.isArray(e)?t.state.keys=e:t.state.keys.push(e),localStorage.setItem(G,JSON.stringify(t.state.keys)),t.emitter.emit(K,t.state.keys)},this.listeners={coins:this.coinsListener,keys:this.keysListener,hp:this.hpListener},this.setters={coins:this.setCoins,keys:this.setKey,hp:this.setHP},this.getters={coins:function(){return t.state.coins},keys:function(){return t.state.keys},hp:function(){return t.state.hp}},this.addCoin=function(){t.setCoins(t.state.coins+1)},this.getSavedValues()}return Object(N.a)(e,[{key:"getSavedValues",value:function(){var e=Object(W.a)(F.a.mark((function e(){var t,i,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t=Number(JSON.parse(localStorage.getItem(J)||"0"))||0,i=Number(localStorage.getItem(Y)),a=JSON.parse(localStorage.getItem(G)||"[]"),t&&(this.state.coins=t),i&&(this.state.hp=i),(null===a||void 0===a?void 0:a.length)&&(this.state.keys=a)}catch(s){}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),q=new Z,ee="coordinates_",te=function(){function e(t){Object(D.a)(this,e),this.cursors=void 0,this.playerBody=void 0,this.playerVisual=void 0,this.playerWhite=void 0,this.camera=void 0,this.playerParamsConfig={blockMove:{left:{blocked:!1,time:0},right:{blocked:!1,time:0}}},this.coordinates={x:0,y:0},this.HP=q.getters.hp();var i=t.world,a=t.map;a&&i&&(this.createPlayer(t,a,i),this.createCamera(t,a,this.playerBody)),this.createTeleport(t,this.playerBody)}return Object(N.a)(e,[{key:"createPlayer",value:function(e,t,i){var a,s=this,r=x,o=t.getObjectLayer("player"),n=null===o||void 0===o?void 0:o.objects[0];this.playerBody=e.physics.add.sprite((null===n||void 0===n?void 0:n.x)||0,(null===n||void 0===n?void 0:n.y)||0,"playerBody").setAlpha(0),this.playerVisual=e.add.sprite(this.playerBody.x,this.playerBody.y,"playerVisual"),this.playerWhite=e.add.sprite(this.playerBody.x,this.playerBody.y,"playerWhite").setAlpha(0).setDepth(1/0),this.playerBody.setBounce(r).setCircle(this.playerBody.width/2),e.physics.add.collider(this.playerBody,i),this.playerBody.body.setCollideWorldBounds(!0),e.physics.world.setBounds(0,0,t.widthInPixels,t.heightInPixels),i.setCollisionByExclusion([-1],!0),this.cursors=null===(a=e.input.keyboard)||void 0===a?void 0:a.createCursorKeys();var l=function(){s.coordinates={x:s.playerBody.x||0,y:s.playerBody.y||0}};try{var c=e.levelName,d=localStorage.getItem("".concat(ee).concat(c));if(d){var h=JSON.parse(d);this.coordinates=h}else l()}catch(u){l()}}},{key:"createCamera",value:function(e,t,i){this.camera=e.cameras.main,this.camera.setBounds(0,0,t.widthInPixels,t.heightInPixels),this.smoothMoveCameraTowards(i)}},{key:"smoothMoveCameraTowards",value:function(e,t){this.camera&&e&&(void 0===t&&(t=0),this.camera.scrollX=t*this.camera.scrollX+(1-t)*(e.x-.5*this.camera.width),this.camera.scrollY=t*this.camera.scrollY+(1-t)*(e.y-.5*this.camera.height))}},{key:"createTeleport",value:function(e,t){var i,a,s,r=this,o=this.coordinates,n=o.x,l=o.y,c=(t.width,t.height,e.add.sprite(n,l,"playerVisual"));c.setAlpha(.5);var d=null===(i=c.preFX)||void 0===i?void 0:i.addDisplacement("diplace",1,.5),h=e.add.particles(0,0,"spark",{speed:{min:0,max:100},angle:{min:0,max:360},scale:{start:.7,end:0},tint:16711935,blendMode:"ADD",lifespan:250,rotate:{min:-180,max:180},emitting:!1}),u=e.add.particles(0,0,"spark",{speed:{min:0,max:250},angle:{min:0,max:360},scale:{start:1.5,end:0},alpha:{start:1,end:0,ease:Phaser.Math.Easing.Quadratic.InOut},tint:33929,blendMode:"ADD",lifespan:400,rotate:{min:-180,max:180},emitting:!1});e.tweens.add({targets:d,x:-1,y:.25,yoyo:!0,loop:-1,duration:5e3,ease:"sine.inout"}),e.tweens.add({targets:c,angle:-360,loop:-1,duration:2e3,ease:"linear"}),e.tweens.add({targets:c,alpha:.25,loop:-1,duration:3500,yoyo:!0,ease:"sine.inout"}),null===(a=e.input.keyboard)||void 0===a||a.on("keydown-ENTER",(function(){r.coordinates={x:t.x||0,y:t.y||0};var i=r.coordinates,a=i.x,s=i.y;c.setPosition(a,s),h.explode(100,a,s);try{var o=e.levelName;localStorage.setItem("".concat(ee).concat(o),JSON.stringify(r.coordinates))}catch(n){}})),null===(s=e.input.keyboard)||void 0===s||s.on("keydown-SPACE",(function(){var e=r.coordinates,i=e.x,a=e.y;t&&(t.x=i,t.y=a),u.explode(300,i,a)}))}},{key:"update",value:function(e,t,i){this.control(t,e,i),this.resetBlockMove(e),this.controlPlayerBody(t),this.smoothMoveCameraTowards(this.playerBody,.9);var a=this.playerVisual,s=a.x,r=a.y;this.playerWhite.setPosition(s,r)}},{key:"controlPlayerBody",value:function(e){this.playerVisual.x=this.playerBody.x,this.playerVisual.y=this.playerBody.y,this.playerBody.body.velocity.x&&(this.playerVisual.angle+=.003*e*this.playerBody.body.velocity.x)}},{key:"control",value:function(e,t,i){var a,s,r,o=u,n=v,l=p,c=f,d=m,h=y,b=g,x=w,k=this.playerBody.body.velocity,O=k.x;!(null===(a=this.cursors)||void 0===a?void 0:a.left.isDown)||this.playerParamsConfig.blockMove.left.blocked||i?!(null===(s=this.cursors)||void 0===s?void 0:s.right.isDown)||this.playerParamsConfig.blockMove.right.blocked||i?this.playerBody.body.blocked.down&&(k.x>b?k.x-=2*e:k.x<-b?k.x+=2*e:k.x=0):this.playerBody.body.blocked.none?k.x+=l:0===O?k.x=n:O<0?k.x=-1*O:k.x<o?k.x+=x(e):k.x>=o&&(k.x=o):this.playerBody.body.blocked.none?k.x-=l:0===O?k.x=-n:O>0?k.x=-1*O:k.x>-1*o?k.x-=x(e):k.x>=-1*o&&(k.x=-1*o),(null===(r=this.cursors)||void 0===r?void 0:r.up.isDown)&&!i&&(this.playerBody.body.blocked.left?(this.setBlockMove("left",t),this.playerBody.setVelocityX(Math.max(c,O)),this.playerBody.setVelocityY(-d)):this.playerBody.body.blocked.right?(this.setBlockMove("right",t),this.playerBody.setVelocityX(Math.min(-c,O)),this.playerBody.setVelocityY(-d)):this.playerBody.body.blocked.down&&this.playerBody.setVelocityY(-h))}},{key:"setBlockMove",value:function(e,t){var i=this.playerParamsConfig.blockMove;i[e].blocked=!0,i[e].time=t}},{key:"resetBlockMove",value:function(e){var t=b,i=this.playerParamsConfig.blockMove,a=i.left,s=i.right,r=e-a.time>t,o=e-s.time>t;r&&(a.blocked=!1),o&&(s.blocked=!1)}}]),e}(),ie=function(){function e(t,i,a){Object(D.a)(this,e),this.scene=void 0,this.extensions=void 0,this.wrapper=void 0,this.tweens=void 0,this.activeDialog=null,this.sceneDialogs=void 0,this.sceneId=void 0,this.sceneId=a,this.sceneDialogs=i,this.scene=t,this.extensions=t.extensions;var s=t.game.config,r=s.width,o=(s.height,Number(r)),n=t.add.sprite(0,0,"dialogLeft").setOrigin(0,0),l=t.add.sprite(o,0,"dialogRight").setOrigin(0,0);l.setPosition(l.x-l.width,l.y);var c=j.buttons,d=t.add.sprite(o-c.margin.right,c.margin.top,"dialogNextButton").setInteractive().setScrollFactor(0).setOrigin(1,0),h=t.add.sprite(o-c.margin.right,2*c.margin.top+c.height,"dialogSkipButton").setInteractive().setScrollFactor(0).setOrigin(1,0),u=this.nextDialog,v=this.dialogEnd,p=u.bind(this),y=v.bind(this,!0);d.on("pointerup",p),h.on("pointerup",y);var g=t.add.tileSprite(n.width,0,o-n.width-l.width,l.height,"dialogCenter").setOrigin(0,0);this.wrapper=t.add.container(0,0).add([n,l,g,d,h]).setScrollFactor(0).setPosition(0,-g.height);var f=t.tweens.create({targets:this.wrapper,y:-g.height,ease:"Quad.easeInOut",repeat:0,duration:k}),m=t.tweens.create({targets:this.wrapper,y:0,ease:"Quad.easeInOut",repeat:0,duration:k});this.tweens={hide:f,show:m},this.createDialogTriggers(t.map)}return Object(N.a)(e,[{key:"tweensPlay",value:function(e,t){var i;i=Array.isArray(e)?e[0]:e,t&&i.once("complete",(function(){t&&t()})),i.play()}},{key:"showDialog",value:function(e){this.activeDialog&&(this.activeDialog.isActive=!0),this.tweensPlay(this.tweens.show,e)}},{key:"hideDialog",value:function(e){this.activeDialog&&(this.activeDialog.isActive=!1),this.tweensPlay(this.tweens.hide,e)}},{key:"createConversation",value:function(e){var t=this.sceneDialogs[e];if(t){this.activeDialog={dialog:t,replica:0,id:e,objects:{}};var i=t[0],a=i.name,s=i.portrait,r=i.replica;this.createPortrait(s),this.createName(a),this.createText(r),this.showDialog()}}},{key:"createPortrait",value:function(e){var t=O,i=t.height,a=t.width,s=t.y,r=this.wrapper.list[0],o=this.scene.add.image(r.width||25,s,e).setOrigin(0);this.extensions.imgFit(o,a,i),this.wrapper.add(o),this.activeDialog&&(this.activeDialog.objects.portrait=o)}},{key:"createName",value:function(e){var t=O,i=t.height,a=t.width,s=this.scene.make.text({x:0,y:0,text:e,origin:{x:.5,y:0},style:{font:"25px Arial",color:j.colors.names,wordWrap:{width:a,useAdvancedWrap:!0}}});s.x=25+a/2,s.y=i+30,this.wrapper.add(s),this.activeDialog&&(this.activeDialog.objects.name=s)}},{key:"createText",value:function(e){var t=O,i=t.y,a=t.width,s=j,r=s.buttons,o=s.colors,n=this.scene.make.text({x:a+50,y:2*i,text:e,origin:{x:0,y:0},style:{font:"bold 25px Arial",color:o.text,wordWrap:{width:Number(this.scene.game.config.width)-100-a-r.width,useAdvancedWrap:!0}}});this.wrapper.add(n),this.activeDialog&&(this.activeDialog.objects.text=n)}},{key:"clearDialog",value:function(){if(this.activeDialog){var e,t,i,a=this.activeDialog.objects;null===(e=a.name)||void 0===e||e.destroy(),null===(t=a.portrait)||void 0===t||t.destroy(),null===(i=a.text)||void 0===i||i.destroy()}}},{key:"nextDialog",value:function(){if(this.activeDialog){var e=this.activeDialog,t=e.dialog,i=e.replica+1;if(i<t.length){var a=t[i],s=a.name,r=a.portrait,o=a.replica;this.clearDialog(),this.createPortrait(r),this.createName(s),this.createText(o),this.activeDialog.replica=i}else this.dialogEnd()}}},{key:"dialogEnd",value:function(e){if(this.activeDialog){var t=this.activeDialog,i=t.dialog,a=t.replica,s=t.id,r=i[a]||i[i.length-1];if(r.callback&&r.callback(),this.closeDialog(),e&&(s||0===s)){var o=JSON.parse(localStorage.getItem("ignoredDialogs")||"[]"),n=o[this.sceneId]||[];n.push(s);var l=Object(A.a)(new Set(n));o[this.sceneId]=l,localStorage.setItem("ignoredDialogs",JSON.stringify(o))}}}},{key:"closeDialog",value:function(){var e=this.clearDialog;this.hideDialog(e.bind(this))}},{key:"createTrigger",value:function(e,t,i,a){var s=j.triggerDebug;return this.scene.extensions.createRectangle(e,t,i,a,65280,s?.3:0)}},{key:"createDialogTriggers",value:function(e){var t=this;if(e){var i=e.getObjectLayer("dialogs"),a=null===i||void 0===i?void 0:i.objects;null===a||void 0===a||a.forEach((function(e){var i,a=e.x,s=void 0===a?-100:a,r=e.y,o=void 0===r?-100:r,n=e.width,l=void 0===n?32:n,c=e.height,d=void 0===c?32:c,h=e.properties,u=Number(null===(i=h.find((function(e){return"id"===e.name})))||void 0===i?void 0:i.value),v=t.scene.add.zone(s,o,l,d).setOrigin(0);t.scene.physics.world.enable(v),v.body.setAllowGravity(!1),v.body.moves=!1;var p=t.scene.player;(null===p||void 0===p?void 0:p.playerBody)&&t.scene.physics.add.overlap(p.playerBody,v,(function(){t.createConversation(u),v.destroy()}))}))}}}]),e}(),ae=i(10),se=function(){function e(t){Object(D.a)(this,e),this.scene=void 0,this.scene=t}return Object(N.a)(e,[{key:"imgFit",value:function(e,t,i){var a=t/e.width,s=i/e.height,r=Math.min(a,s,1);e.setScale(r)}},{key:"createRectangle",value:function(e,t,i,a,s,r){return this.scene.add.graphics().fillStyle(s,r).fillRect(e,t,i,a)}},{key:"getPropsFromObject",value:function(e){return e.reduce((function(e,t){var i=t.name,a=t.value;return Object(I.a)(Object(I.a)({},e),{},Object(ae.a)({},i,a))}),{})}},{key:"findCorners",value:function(e){var t=Math.min.apply(null,e.reduce((function(e,t){var i=t.x;return e.push(i),e}),[])),i=Math.min.apply(null,e.reduce((function(e,t){var i=t.y;return e.push(i),e}),[])),a=Math.max.apply(null,e.reduce((function(e,t){var i=t.x,a=t.width;return e.push(i+a),e}),[])),s=Math.max.apply(null,e.reduce((function(e,t){var i=t.y,a=t.height;return e.push(i+a),e}),[])),r=Math.max.apply(null,e.reduce((function(e,t){var i=t.y;return e.push(i),e}),[]));return{x:t,y:r,rectWidth:a-t,rectHeight:s-i}}}]),e}(),re=Q("setVelocity"),oe=B.animation,ne=oe.duration,le=oe.ease,ce=function(){function e(t){var i;Object(D.a)(this,e),this.scene=void 0,this.state={},this.overlap=!1,this.invincible=!1,this.scene=t;var a=t.map,s=null===(i=t.player)||void 0===i?void 0:i.playerBody;a&&s&&(this.createButtons(t,a,s),this.createWalls(t,a,s),this.createCoins(t,a,s),this.createTraps(t,a,s),this.createFinish(t,a,s))}return Object(N.a)(e,[{key:"createButtons",value:function(e,t,i){var a=this,s=t.getObjectLayer("buttons"),r=null===s||void 0===s?void 0:s.objects,o=e.textures.get("button").getFrameNames(),n=Object(l.a)(o,2),c=n[0],d=n[1];null===r||void 0===r||r.forEach((function(s,r){var o=s.x,n=void 0===o?-100:o,l=s.y,h=void 0===l?-100:l,u=s.width,v=void 0===u?-100:u,p=s.height,y=void 0===p?-100:p,g=s.properties,f=e.extensions.getPropsFromObject(g),m=n+v/2,b=h+y,x=f.invisible?null:e.add.sprite(m,b,"button",c).setOrigin(.5,1),w=e.add.zone(n,h,v,y).setOrigin(0,0);e.physics.world.enable(w,Phaser.Physics.Arcade.STATIC_BODY),re(w)&&w.setAllowGravity(!1),e.physics.add.overlap(i,w,(function(){var s=f.key,r=q.getters.keys().find((function(e){return e===s}));s&&!r||(a.overlap=!0,setTimeout((function(){a.overlap=!1}),5),null===x||void 0===x||x.setTexture("button",d),f.is_wall?a.activateWall(e,t,i,f.id):a.activateBridge(e,t,i,f.id),w.destroy())}))}))}},{key:"createFinish",value:function(e,t,i){var a=t.getObjectLayer("finish"),s=null===a||void 0===a?void 0:a.objects,r=e.textures.get("finish").getFrameNames();null===s||void 0===s||s.forEach((function(t){var a=t.x,s=void 0===a?-100:a,o=t.y,n=void 0===o?-100:o,l=t.width,c=void 0===l?-100:l,d=t.height,h=void 0===d?-100:d,u=t.properties,v=e.extensions.getPropsFromObject(u),p=e.add.tileSprite(s,n,c,h,"buttons",r[0]).setOrigin(0,1);e.physics.world.enable(p),re(p.body)&&p.body.setAllowGravity(!1),e.physics.add.overlap(i,p,(function(){var e=v.nextLevelId;console.log("\ud83d\ude80 ~ ~ nextLevelId:",e)}))}))}},{key:"createCoins",value:function(e,t,i){var a=this;e.anims.create({key:"coinAnimation",frames:"coin",frameRate:10,repeat:-1});var s=e.add.particles(0,0,"spark",{speed:{min:0,max:80},angle:{min:0,max:360},scale:{start:.5,end:0},alpha:{start:0,end:1},blendMode:"ADD",lifespan:500,rotate:{min:-180,max:180},emitting:!1}),r=t.getObjectLayer("coins");null===r||void 0===r||r.objects.map((function(t){var r=t.x,o=void 0===r?0:r,n=t.y,l=void 0===n?0:n,c=(t.width,t.height,e.add.sprite(o,l,"coin",0).setOrigin(0,1));c.play("coinAnimation"),a.scene.physics.world.enable(c,Phaser.Physics.Arcade.STATIC_BODY),e.physics.add.overlap(i,c,(function(){a.overlap=!0,setTimeout((function(){a.overlap=!1}),5);var e=c.x,t=c.y,i=c.width,r=c.height;s.explode(100,e+i/2,t-r/2),c.destroy(),q.addCoin()}))}))}},{key:"createWalls",value:function(e,t,i){var a=this,s=t.getObjectLayer("walls"),r=null===s||void 0===s?void 0:s.objects,o=e.textures.get("bridges").getFrameNames(),n={};null===r||void 0===r||r.forEach((function(t,i){var a=t.x,s=void 0===a?-100:a,r=t.y,l=void 0===r?-100:r,c=t.width,d=void 0===c?0:c,h=t.height,u=void 0===h?0:h,v=t.properties,p=e.extensions.getPropsFromObject(v);if(void 0!==p.id){var y=e.add.tileSprite(s,l+u,d,u,"bridges",o[0]).setOrigin(0,1);n[p.id]||(n[p.id]=[]),n[p.id].push({props:p,sprite:y})}})),Object.entries(n).forEach((function(t){var s=Object(l.a)(t,2),r=s[0],o=s[1],n=e.extensions.findCorners(o.map((function(e){return e.sprite}))),c=n.x,d=n.y,h=n.rectWidth,u=n.rectHeight,v=e.add.zone(c,d,h,u).setOrigin(0,1);a.scene.physics.world.enable(v,Phaser.Physics.Arcade.STATIC_BODY),re(v.body)&&(v.body.setAllowGravity(!1).setImmovable().setFriction(0,0),v.body.moves=!1),e.physics.add.collider(i,v,(function(){})),a.state[r]={body:v,bridges:o}}))}},{key:"activateBridge",value:function(e,t,i,a){var s=this;if(void 0!==a){var r=t.getObjectLayer("bridges"),o=null===r||void 0===r?void 0:r.objects,n=e.textures.get("bridges").getFrameNames(),l=Number(t.heightInPixels),c=[];null===o||void 0===o||o.forEach((function(t,i){var s=t.x,r=void 0===s?-100:s,o=t.y,d=void 0===o?-100:o,h=t.width,u=void 0===h?0:h,v=t.height,p=void 0===v?0:v,y=t.properties,g=e.extensions.getPropsFromObject(y);if(g.id===a){var f=g.from_top?2*-p:l+2*p,m=e.add.tileSprite(r,f,u,p,"bridges",n[0]).setOrigin(0,0);c.push(Object(I.a)(Object(I.a)({},m),{},{y:d}));e.tweens.add({targets:m,y:d,ease:le,duration:ne,repeat:0})}})),setTimeout((function(){var t=e.extensions.findCorners(c),a=t.x,r=t.y,o=t.rectWidth,n=t.rectHeight,l=e.add.zone(a,r,o,n).setOrigin(0,0);s.scene.physics.world.enable(l,Phaser.Physics.Arcade.STATIC_BODY),re(l.body)&&(l.body.setAllowGravity(!1).setImmovable().setFriction(0,0),l.body.moves=!1),e.physics.add.collider(i,l,(function(){}))}),ne)}}},{key:"activateWall",value:function(e,t,i,a){if(a){var s=Number(t.heightInPixels),r=this.state[a],o=r.body,n=r.bridges;o.destroy(),n.forEach((function(t){var i=t.props,a=t.sprite,r=i.from_top?-(a.height+100):Number(s)+a.height+100;e.tweens.add({targets:a,y:r,ease:le,duration:ne,repeat:0})}))}}},{key:"createTraps",value:function(e,t,i){var a=this,s=t.getObjectLayer("traps"),r=null===s||void 0===s?void 0:s.objects;null===r||void 0===r||r.forEach((function(t){var s=t.x,r=void 0===s?-100:s,o=t.y,n=void 0===o?-100:o,l=t.width,c=void 0===l?0:l,d=t.height,h=void 0===d?0:d,u=e.add.zone(r,n,c,h).setOrigin(0,0);e.physics.world.enable(u,Phaser.Physics.Arcade.STATIC_BODY),e.physics.add.overlap(i,u,(function(){if(i.setAlpha(0),!a.invincible){var t;a.invincible=!0;var s=e.player,r=null===(t=e.player)||void 0===t?void 0:t.playerWhite;if(!r||!s)return;s.HP-=10,s.HP<=0&&e.dead(),r.setAlpha(1);var o=0,n=setInterval((function(){var e=1===r.alpha?0:1;r.setAlpha(e),++o>=5&&(clearTimeout(n),a.invincible=!1)}),100)}}))}))}}]),e}(),de=5,he=5,ue=16,ve=100,pe=function(){function e(t){var i,a=this;Object(D.a)(this,e),this.scene=void 0,this.hpBar=void 0,this.hitId=null,this.hitTween=void 0,this.prevHpValue=100,this.update=function(){var e;a.scene.player&&(null===(e=a.scene.player)||void 0===e?void 0:e.HP)!==a.prevHpValue&&a.hit()},this.scene=t,this.prevHpValue=(null===(i=t.player)||void 0===i?void 0:i.HP)||100,this.createHPBar()}return Object(N.a)(e,[{key:"createHPBar",value:function(){var e=ve,t=ue,i=de,a=he,s=this.scene.add.graphics().fillStyle(16777215).fillRect(0,0,t,e);s.generateTexture("hpLine",t,e),s.destroy(),this.hpBar=this.scene.add.sprite(i,a,"hpLine").setTint(16711680).setOrigin(0,0).setScrollFactor(0)}},{key:"hit",value:function(){var e=this,t=0;if(null===this.hitId){var i=this.scene.player.HP;this.hitId=setInterval((function(){var a,s,r=!!(t%2);(t++,null===(a=e.hpBar)||void 0===a||a.setTint(r?16777215:16711680),t>=10)&&(null===(s=e.hpBar)||void 0===s||s.setTint(16711680),clearInterval(e.hitId),e.hitId=null,e.prevHpValue=i)}),50);var a=i/q.getters.hp();console.log("\ud83d\ude80 ~ GameInterface ~ hit ~ percent:",a,i,q.getters.hp());this.scene.tweens.add({targets:this.hpBar,scaleY:a,ease:"linear",duration:300})}}}]),e}(),ye=function(e){Object(P.a)(i,e);var t=Object(T.a)(i);function i(){return Object(D.a)(this,i),t.call(this,"ex_0")}return i}(function(e){Object(P.a)(i,e);var t=Object(T.a)(i);function i(e){var a;return Object(D.a)(this,i),(a=t.call(this,{key:e})).player=null,a.dialog=null,a.level=null,a.interface=null,a.extensions=void 0,a.map=null,a.world=null,a.visual=null,a.levelName=void 0,a.restart=!1,a.levelName=e,a}return Object(N.a)(i,[{key:"preload",value:function(){this.extensions=new se(this),C.call(this,Object(I.a)(Object(I.a)({},R),{},{tilemapTiledJSON:[].concat(Object(A.a)(R.tilemapTiledJSON),[["map",L+"levels/".concat(this.levelName,".json")]])}))}},{key:"create",value:function(){var e=this;this.map=this.make.tilemap({key:"map"}),console.log("\ud83d\ude80 ~ DefaultScene ~ create ~ this.map:",this.map);var t=H.map((function(t){var i;return null===(i=e.map)||void 0===i?void 0:i.addTilesetImage(t,t)})).filter((function(e){return!!e}));if(!t.length)throw"wrong tileset data: ".concat(JSON.stringify(t));this.world=this.map.createLayer("level",t,0,0),this.visual=this.map.createLayer("visual",t,0,0),this.player=new te(this),this.dialog=new ie(this,M,0),this.level=new ce(this),this.interface=new pe(this)}},{key:"dead",value:function(){var e=this;this.restart||(this.restart=!0,this.tweens.add({targets:this.cameras.main,alpha:0,duration:500,onComplete:function(){setTimeout((function(){e.restart=!1,e.scene.restart()}),500)}}))}},{key:"update",value:function(e,t){var i,a,s,r,o;null===(i=this.player)||void 0===i||i.update(e,t,(null===(a=this.dialog)||void 0===a||null===(s=a.activeDialog)||void 0===s?void 0:s.isActive)||(null===(r=this.level)||void 0===r?void 0:r.overlap)||this.restart),null===(o=this.interface)||void 0===o||o.update()}}]),i}(c.Scene)),ge={type:Phaser.AUTO,parent:"game-box",height:720,width:1280,scene:[ye],backgroundColor:1310779,physics:{default:"arcade",arcade:{gravity:{y:h}}}},fe=i(15),me=i.n(fe),be=i(4),xe=null,we=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),i=t[0],s=t[1];return Object(a.useEffect)((function(){return i&&setTimeout((function(){i.offsetWidth,xe=new d.a.Game(ge)}),0),function(){var e;null===(e=xe)||void 0===e||e.destroy(!0,!1)}})),Object(be.jsx)("div",{className:me.a.root,children:Object(be.jsx)("div",{className:me.a.game,id:"game-box",ref:function(e){s(e)}})})};var ke=function(){return Object(be.jsx)("div",{className:n.a.root,children:Object(be.jsx)(we,{})})};i(28);r.a.render(Object(be.jsx)(ke,{}),document.getElementById("root"))}},[[29,1,2]]]);
//# sourceMappingURL=main.a112803b.chunk.js.map